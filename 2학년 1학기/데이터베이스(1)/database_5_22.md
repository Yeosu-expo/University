# 6장 데이터베이스 언어 SQL (3)
## SQl을 이용한 데이터 조작
### 데이터 검색: SELECT 문
#### 정렬 검색
* SQL 명령문에서 검색된 겨로가는 테이블에 데이터가 입력된 순서대로 검색
* ORDER BY 키워드를 이용해 결과 테이블 내용을 사용자가 원하는 순서로 출력
  * 오름차순(기본값): ASC(ascending)/내림차순: DESC(descending)
  * 널 값은 오름차순에서는 맨 마지막에 출력되고, 내림차순에서는 맨 먼저 출력됨
  * 여러 기준에 따라 정렬하려면 정렬 기준이 되는 속성을 차례대로 제시
```sql
SELECT 속성_리스트
FROM 테이블_리스트
WHERE 조건
ORDER BY 속성_리스트;
```
##### 예제26
고객 테이블에서 고객이름, 등급, 나이를 검색하되, 나이를 기준으로 내림차순 정렬해보자.
```sql
SELECT 고객이름, 등급, 나이
FROM 고객
ORDER BY 나이 DESC
```
|     | 고객이름 | 등급   | 나이 |
| --- | -------- | ------ | ---- |
| 1   | 오형준   | sliver | NULL |
| 2   | 성원용   | gold   | 35   |
| 3   | 채광주   | sliver | 31   |
... 

##### 예제27
주문 테이블에서 수량이 10개 이상인 주문의 주문고객, 주문제품, 수량, 주문일자를 검색해보자. 단, 주문제품을 기준으로 오름차순으로 정렬하고, 동일 제품은 수량을 기준으로 내림차순 정렬해보자.

```sql
SELECT 주문고객, 주문제품, 수량, 주문일자
FROM 주문
WHERE 수량 >=10
ORDER BY 수량 ASC 주문제품 DESC
```
#### 정렬 검색
* NULL값을 오름차순에서는 맨 마지막에 출력되고, 내림차순에서는 맨 먼저 출력됨
* NULL값의 위치를 저앟고 싶다면?
  * ;NULLS FIRST와 NULLS LAST 키워드를 이용
NULL값을 먼저 이용할 때
```sql
SELECT 
FROM
ORDER BY COL1 ASC NULLS FIRST;
```

#### 집계 함수를 이용한 검색
* 특정 속성 값을 통계적으로 계산한 결과를 검색하기 위해 집계 함수를 이용
  * 열함수라고도 함.
  * 개수, 합계, 평군, 최댓값, 최솟값의 계산 기능을 제공
* 주의사항
  * 집계 함수는 널인 속성 값을 제외하고 계싼함
  * 집계 함수는  WHERE절에서는 사용할 수 없고, **SELECT절이나 HAVING 절에서만 사용 가능**

집계함수
| 함수  | 의미             | 사용 가능한 속성의 타입 |
| ----- | ---------------- | ----------------------- |
| COUNT | 속성 값의 개수   | 모든 데이터             |
| MAX   | 속성 값의 최댓값 |
| MIN   | 속성 값의 최솟값 |
| SUM   | 속성 값의 합계   | 숫자 데이터             |
| AVG   | 속성 값의 평균   |

##### AVG()
* 표현식 SELECT AVG(속성명)
* 내부에서 산술연산을 통해 결과를 출력
* 따라서 데이터 안에 NULL값 존재시 ERROR 발생
* IFNULL함수를 이용해서 NULL값을 처리한 후 진행

##### 예제28
제품 테이블에서 모든 제품의 단가 평균을 검색해보자.
```sql
SELECT AVG(단가)
FROM 제품;
```
##### SUM()
* 표현식: SELECT SUM(속성명)
* 내부에서 산술연사을 통해 결과를 출력
* 따라서 데이터 안에 NULL값 존재시 ERROR발생
* IFNULL함수를 이용해서 NULL값을 처리한 후 진행
##### 예제29
한빛제과에서 제조한 제품의 재고량 합계를 제품 테이블에서 검색해보자
```sql
SELECT SUM(재고향) AS "재고량 합계"
FROM 제품
WHERE 제조업체 = '한빛제과'
```
|     | 재고량 합계 |
| --- | ----------- |
| 1   | 6500        |

#### COUNT()
* 표현식: SELECT COUNT(속성명)
* 속성에 있는 데이터의 행의 개수를 확인할 때 사용
* 전체 데이터의 개수를 확인하고 싶을 때는
  * SELECT COUNT(*)
  * FROM 테이블명
* 주의
  * COUNT(*)를 사용하면 NULL값을 포함한 행의 개수를 계산 NULL값을 제외한 데이터 행의 개수를 구하고 싶다면 SELECT COUNT(속성명)을 사용하면 된다.

##### 예제30
고객 테이블에 고객이 몇 명 등록되어 있는지 검색해보자.

1. 고객아이디 속성을 이용해 계산하는 경우
```sql
SELECT COUNT(고객아이디) AS 고객수
FROM 고객;
```
2. 나이 속성을 이용해 계산하는 경우
```sql
SELECT COUNT(나이) AS 고객수
FROM 고객;
```
3. *를 이용해 계산하는 경우
```sql
SELECT COUNT(*) AS 고객수
FROM 고객;
```
#### DISTINCT
* 중복되지 않는 데이터의 개수 구할 떄
* SELECT COUNT(DISTINCT 속성명)

##### 예제21
제품 테이블에서 제조업체의 수를 검색해보자.
![Alt text](./img/화면%20캡처%202023-05-22%20예제31.png)
```sql
SELECT COUNT(DISTINCT 제조업체) AS "제조업체 수"
FROM 제품;
```
| --  | 제조업체수 |
| --- | ---------- |
| 1   | 3          |

#### 그룹별 검색
* GROUP BY절은 테이블에서 검색된 행들을 특정 열을 기준으로 나눔
* GROUP BY 키워드를 이용해 특정 속성의 값이 값은 투플을 모아 그룹을 만들고, 그룹별로 검색
  * GROUP BY 키워드와 함께 그룹을 나누는 기준이 되는 속성을 지정
* HAVING 키워드를 함께 이용해 그룹에 대한 조건을 작성
* 그룹을 나누는 기준이 되는 속성을 SELECT절에도 작성하는 것이 좋음

##### 예제32
주문 테이블에서 주문제품별 수량의 합계를 검색해보자.
```sql
SELECT 주문제품, SUM(수량) AS 총주문수량
FROM 주문
GROUP BY 주문제품;
```
>> 주문제품을 기준으로 그룹별로 수량의 합을 구해서 산출한다.

##### 예제33
제품 테이블에서 제조업체별로 제조한 제품의 개수와 제품 중 가장 비싼 단가를 검색하되, 제품의 개수는 제품수라는 이름으로 출력하고 가장 비싼 단가는 최고가라는 이름으로 출력해보자.
```sql
SELECT 제조업체, COUNT(*) AS 제품수, MAX(단가) AS 최고가
FROM 제품
GROUP BY 제조업체;
```
| --  | 제조업체 | 제품수 | 최고가 |
| --- | -------- | ------ | ------ |
| 1   | 대한식품 | 2      | 4500   |
| 2   | 인국푸드 | 2      | 5500   |
| 3   | 한빛제과 | 3      | 2600   |

#### 그룹별 검색:HAVING()
* 그룹별로 검색할 때는 집계함순 GROUP BY절에 있는 속성 외의 속성은 SELECT절에 사용할 수 없음

e.g.)
```sql
SELECT 도서번호, 주문번호, AVG(주문수량) AS 평균주문수량
FROM 주문도서
GROUP BY 도서번호;
```
>> ERROR발생
>> SELECT절에 GROUP BY에 주문번호가 없는데 사용해서 오류가 남.

##### 예제34
제품 테이블에서 제품을 3개 이상 제조한 제조업체별로 제품의 개수와 제품 중 가장 비싼 단가를 검색해보자.
```sql
SELECT 제조업체, COUNT(*) AS 제품수, MAX(단가) AS 최고가
FROM 제품
GROUP BY 제조업ㅊ HAVING COUNT(*) >=3;
```
| --  | 제조업체 | 제품수 | 최고가 |
| --- | -------- | ------ | ------ |
| 1   | 한빛제과 | 3      | 2600   |

#### 여러 테이블에 대한 조인 검색
* 조인 검색: 여러 개의 테이블을 연결하여 데이터를 검색하는 것
* 조인 속성: 조인 검색을 위해 테이블을 연결해주는 속성(주로 외래키)
  * 연결하려는 테이블 간에 조인 속성의 이름은 달라도 되지만 도메인은 같아야 함
  * 일반적으로 외래키를 조인 속성으로 이용함
* FROM절에서 검색에 필요한 모든 테이블을 나열
* WHERE절에 조인 속성의 값이 같아야 함을 의미하는 조인 조건을 제시
* 같은 이름의 속성이 서로 다른 테이블에 존재할 수 있기 때문에 속성 이름 앞에 해당 속성이 소속된 테이블의 이름을 표시

* 하나의 SQL 명령문으로 여러 테이블에 저장된 데이터를 한 번에 검색
* 조인문 작성 순서
  * 1단계: SELECT절에서 검색하고자 하는 열 이름들을 명시
  * 2단계: FROM절에서 SELECT절에 지정된 열 이름들의 소속 테이블 이름을 명시
  * 3단계: FROM절에 지정된 테이블 이름이 두 개 이상이면, 조인을 위해서 WHERE절에 조인 조건절을 명시
>> 조인 조건 절은 서로 다른 두 개 테이블의 공통 열을 연결하여 비교
>> N개의 테이블을 조인하기 위해서는 WHERE절에 반드시 N-1개의 조인 조건절을 필요로 한다
##### 예제37
판매 데이터베이스에서 banana 고객이 주문한 제품의 이름을 검색해보자.
![Alt text](./img/화면%20캡처%202023-05-22%20예제37.png)
```sql
SELECT 제품, 제품명
FROM 제품, 주문
WHERE 주문.주문고객='banana' AND 제품.제품번호 = 주문.주문제품;
```
| --  | 제품명     |
| --- | ---------- |
| 1   | 그냥만두   |
| 2   | 맛난초콜릿 |
| 3   | 통통우동   |