# 제2장 CPU의 구조와 기능
## CPU의 기능
* 명령어 인출(instruction **fetch**)
  * 기억장치로부터 명령어를 읽어옴 
* 명령어 해독(instruction **decode**)
  * 어떤 동작을 수행할지 정하기 위해 명령어 해독 제어유닛에서(CU)
* 명령어 수행(instruction **acticution**)
  * 읽어온 명령을 수행 CU에서 ALU에서
명령어:opcode(연산코드)+opprend(명령어 수행을 위한 데이터 주소)를 가진다 

> 명령어를 인출하고 해독해서 수행하는 이 과정, 한 개의 명령어를 수행하는데 필요한 전체 과정을 명령어 사이클이라고 한다.
* 인출 사이클
  * 명령어를 읽어오는 단계
* 실행 사이클
  * 명령어를 실행하는 단계

* 데이터 인출(Data Fetch)
  * 명령어 실행을 위하여 데이터가 필요한 경우에는 기억장치 혹은 I/O 장치로부터 그데이터를 읽어온다
* 데이터 처리(Data Process)
  * 데이터에 대한 산술적 혹은 논리적 연산을 수행
* 데이터 저장(Data Store)
  * 수행한 결과를 저장


## CPU 구성
* ALU
* CU
* Register
* cpu interanl bus
  * 외부 인터널 버스보다 빠르다

### 명령어 실행에 필요한 CPU 내부 레지스터
* 프로그램 카운터(PC:Program Counter)
  * 한 명령어를 실행하고 다음에 인출한 명령어의 주소를 가지고 있는 레지스터
  * 명령어를 수행하고 자동적으로 주소 크기만큼 증가함(배열 같이)
* 누산기(AC:Accumulator)
  * 산술연산 후 일시적으로 데이터를 저장하기 위한 공간
  * 오퍼랜드에 있는 데이터를 저장
* 명령어 레지스터(IR:Instruction register)
  * 기억장치에서 명령어를 가져온 후 CU에 보내기 전에 잠시 가지고 있는 레지스터
  * IR에 명령어가 올라오면, 명령어 인출의 끝 지점이다.
  * 항상 가장 최근에 인출된 명령어가 담겨있다.
  * opcode를 해석해서 CU에 넘겨줌
  * 오퍼랜드를 해석해서 AC에 넘겨줌
* 기억장치 주소 레지스터(MAR)
  * PC에 담긴 명령어 주소를 주소버스로 가기 전에 잠시 담고 있는 곳
  * CPU의 버스와 외부버스가 다르기 때문에 일종의 완중장치
* 기억장치 버퍼 레지스터(MBR)
  * 기억장치에서 가져온(기억장치에서 데이터버스, 데이터버스에서 MBR) 명령어를 잠시 저장하는 곳
  * CPU의 버스와 외부버스가 다르기 때문에 일종의 완중장치

#### 동작흐름
1. PC에 담긴 주소로 MAR을 거처 주소버스로 명령어주소를 전달
2. 기억장치에서 데이터를 담고 버슬 통해 MBR에 도착
3. 명령어가 IR에 도착
4. CU로 전달
> 1~3번 과정을 CPU의 한 클록(clock)주기이다.
즉, CPU 클록속도가 1GHz라면 1초에 10^9번 1~3번을 한다는 것
따라서 1주기는 1ns에 처리됨

#### PC예시
1. 만약 1word가 4바이트이고, 메모리가 1바이트 반위로 구성되어 있다
   1. 그러면 1word를 처리할때 4바이트를 처리해야한다
   2. 그러면, PC > PC + 4이다

#### 어셈블리 실행예시
1. LOAD 250
   1. 기억장치 250에 있는 데이터를 AC에 저장
2. ADD 251
   1. AC에 있는 값과 기억장치 251에 있는 값과 더해서 더한 값을 AC에 저장
   2. 중간의 연산은 ALU에서 실행
      1. AC를 ALU에 올리고
      2. 251번지 값을 ALU에 올림
      3. 더한 값을 AC에 넘김
3. STA 251
   1. AC에 있는 값을 기억장치 251에 저장 함
4. JUMP 170
   1. 기억장치 170에 있는 명령어로 넘어가도록 함
   2. 170을 PC로 올리는 것임
물론 그 이전에 PC에 있는 오퍼랜드 주소의 명령어를 IR에 올리는 과정이 있었음
또한, 계속 PC > PC + 1을 하고 있음